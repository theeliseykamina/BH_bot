# Telegram-бот для генерации договоров аренды

Автоматизированный бот для создания договоров найма жилых помещений. 
Собирает данные о сторонах, объекте и условиях аренды через диалог в Telegram, 
затем формирует готовый договор в формате DOCX.

---

## Возможности

- Пошаговый сбор данных через интерактивный диалог
- Автоматическое форматирование дат, сумм, адресов и ФИО
- Валидация введённых данных на каждом этапе
- Возможность пропускать необязательные поля
- Кнопка "Назад" для исправления предыдущих ответов
- Предпросмотр договора перед генерацией
- Поддержка дополнительных документов (комиссия, акт приёма-передачи)
- Автоматическое удаление временных файлов после отправки

---

## Структура проекта
```
BH_bot/
├── main.py                  # Главный файл бота (логика Telegram)
├── form_logic.py            # Функции форматирования и валидации
├── fields.py                # Список полей (вопросы и форматтеры)
├── requirements.txt         # Зависимости проекта
├── .env                     # Токен бота (не коммитится)
├── template.docx            # Шаблон основного договора
├── template_sob.docx        # Шаблон комиссии от наймодателя
├── template_okaz.docx       # Шаблон комиссии от нанимателя
└── out/                     # Временная папка для генерации файлов
```

---

## Установка на сервере

### 1. Клонирование репозитория
```bash
git clone https://github.com/theeliseykamina/BH_bot.git
cd BH_bot
```

### 2. Создание виртуального окружения
```bash
python3 -m venv .venv
source .venv/bin/activate
```

### 3. Установка зависимостей
```bash
pip install -r requirements.txt
```

### 4. Настройка переменных окружения

Создайте файл `.env` в корне проекта:
```bash
nano .env
```

Добавьте токен бота:
```
BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrSTUvwxYZ
```

Сохраните файл (Ctrl+O, Enter, Ctrl+X).

---

## Настройка шаблонов

**Важно:** Бот работает с шаблонами Word, которые содержат переменные в формате `{{variable}}`.

### Требования к шаблонам:

1. Все переменные должны соответствовать ключам из `fields.py`
2. Используйте синтаксис Jinja2: `{{naim_name}}`, `{{obj_address}}` и т.д.
3. Для условной логики используйте: `{% if variable %}...{% endif %}`

### Список основных переменных:

Смотрите файл `fields.py` — там перечислены все поля с их ключами (`key`).

**Примеры:**
- `{{naim_name}}` — ФИО нанимателя
- `{{ar_name}}` — ФИО наймодателя
- `{{obj_address}}` — адрес объекта
- `{{rent_start}}` — дата начала найма
- `{{monthly_payment}}` — ежемесячная плата (прописью)
- `{{mcnum}}` — ежемесячная плата (цифрами)

### Как создать шаблон:

1. Откройте Word
2. Создайте структуру договора
3. Вместо конкретных данных вставьте переменные: `{{variable}}`
4. Сохраните как `template.docx`

Пример:
```
ДОГОВОР НАЙМА ЖИЛОГО ПОМЕЩЕНИЯ

г. Санкт-Петербург                                {{date}}

{{ar_name}}, именуемый в дальнейшем "Наймодатель", 
с одной стороны, и {{naim_name}}, именуемый в дальнейшем "Наниматель",
с другой стороны, заключили настоящий договор о нижеследующем:

1. Предмет договора
1.1. Наймодатель передаёт, а Наниматель принимает во временное 
владение и пользование жилое помещение, расположенное по адресу:
{{obj_address}}
```

## Используемые технологии

- **Python 3.11+**
- **python-telegram-bot 22.4** — взаимодействие с Telegram Bot API
- **docxtpl** — генерация DOCX из шаблонов
- **num2words** — конвертация чисел в слова (прописью)
- **babel** — форматирование дат
- **python-dotenv** — работа с переменными окружения

---

## Безопасность

- `.env` файл не коммитится в Git (указан в `.gitignore`)
- Временные файлы (`out/`) автоматически удаляются после отправки
- Шаблоны договоров не включаются в репозиторий (добавьте свои)

---

## Структура работы бота

1. Пользователь отправляет `/start`
2. Бот задаёт вопросы последовательно (согласно `fields.py`)
3. Каждый ответ валидируется и форматируется
4. После заполнения всех полей показывается предпросмотр
5. Бот генерирует DOCX из шаблона с подстановкой данных
6. Файл отправляется пользователю
7. Предлагаются дополнительные документы (комиссия, акт)

---

## Разработка и доработка

### Добавление нового поля

1. Откройте `fields.py`
2. Добавьте новый элемент в список `FIELDS`:
```python
{
    "key": "new_field",
    "question": "Введите новое поле:",
    "formatter": format_function  # или None для текста без обработки
}
```

3. Добавьте переменную `{{new_field}}` в шаблон Word
4. Перезапустите бота

### Изменение логики форматирования

Все функции форматирования находятся в `form_logic.py`:
- `format_fio()` — форматирование ФИО
- `format_date()` — форматирование дат
- `format_money()` — форматирование сумм
- `format_location()` — форматирование адресов

---

## Поддержка

**Разработчик:** @theeliseykamina  
**Канал:** t.me/theeliseykamina

Проект создан для автоматизации оформления договоров аренды и упрощения работы риелторов.

---

## Лицензия

MIT License — свободное использование с указанием авторства.